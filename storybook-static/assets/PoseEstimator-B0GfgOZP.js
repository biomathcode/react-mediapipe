import{j as e}from"./jsx-runtime-u17CrQMm.js";import{r as n}from"./iframe-IhaqzqUC.js";import{_ as U}from"./preload-helper-PPVm8Dsz.js";const _=({type:f})=>{let[l,u]=n.useState(0);return e.jsxs("button",{className:"storybook-button",onClick:()=>u(l+1),children:["my button",e.jsx("br",{})," type: ",f,e.jsx("br",{})," count: ",l]})};_.__docgenInfo={description:"",methods:[],displayName:"MyButton"};function R(f={}){const{modelUrl:l="https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task",delegate:u="GPU",numPoses:x=1,runningMode:m="IMAGE",drawSkeleton:g=!0}=f,o=n.useRef(null),y=n.useRef(null),r=n.useRef(null),p=n.useRef(!1),[j,P]=n.useState(!1);n.useEffect(()=>{let t=!1;async function i(){const s=await U(()=>import("./vision_bundle-DGPdMwIz.js"),[],import.meta.url),{FilesetResolver:a,PoseLandmarker:d,DrawingUtils:h}=s,b=await a.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm"),v=await d.createFromOptions(b,{baseOptions:{modelAssetPath:l,delegate:u},runningMode:m,numPoses:x});if(t){v.close?.();return}r.current={pose:v,DrawingUtils:h},P(!0)}return i().catch(s=>{console.error("Failed to initialize PoseLandmarker:",s)}),()=>{if(t=!0,r.current)try{r.current.pose?.close()}catch{}}},[l,u,x,m]);const w=n.useCallback(async t=>{if(!r.current)return null;const{pose:i}=r.current;if(!i)return null;try{if(m==="VIDEO"){const s=performance.now();return await new Promise(a=>{i.detectForVideo(t,s,d=>a(d))})}else return await new Promise(s=>{i.detect(t,a=>s(a))})}catch(s){return console.error("Pose detection error:",s),null}},[m]),N=n.useCallback(async()=>{if(!(!o.current||!navigator.mediaDevices?.getUserMedia))try{const t=await navigator.mediaDevices.getUserMedia({video:!0});o.current.srcObject=t,await o.current.play()}catch(t){console.warn("Error accessing camera:",t)}},[]),k=n.useCallback(()=>{const t=o.current?.srcObject;t&&(t.getTracks().forEach(i=>i.stop()),o.current.srcObject=null)},[]),c=n.useCallback(t=>{p.current=!0;async function i(){if(!p.current)return;const s=o.current,a=y.current;if(s&&a&&r.current){a.width=s.videoWidth||640,a.height=s.videoHeight||480;const d=await w(s);if(d&&r.current&&r.current.DrawingUtils&&a.getContext){const h=a.getContext("2d");if(h.clearRect(0,0,a.width,a.height),h.drawImage(s,0,0,a.width,a.height),d.landmarks&&g)for(const b of d.landmarks){const v=new r.current.DrawingUtils(h);v.drawLandmarks(b,{radius:E=>r.current.DrawingUtils.lerp(E.from.z,-.15,.1,5,1)}),v.drawConnectors(b,r.current.pose.POSE_CONNECTIONS)}}t&&t(d)}p.current&&window.requestAnimationFrame(i)}window.requestAnimationFrame(i)},[w,g]),C=n.useCallback(()=>{p.current=!1},[]);return{ready:j,videoRef:o,canvasRef:y,startCamera:N,stopCamera:k,startLoop:c,stopLoop:C,detectImage:w,stopCamera:k}}function I(f){const{modelUrl:l,onResults:u,showCanvas:x=!0,className:m="",runningMode:g="VIDEO",numPoses:o=1,drawSkeleton:y=!0}=f||{},{ready:r,videoRef:p,canvasRef:j,startCamera:P,stopCamera:w,startLoop:N,stopLoop:k}=R({modelUrl:l,runningMode:g,numPoses:o,drawSkeleton:y}),[c,C]=n.useState(!1);n.useEffect(()=>{c&&r?N(u):k()},[c,r]);const t=async()=>{c?(w(),C(!1)):(await P(),C(!0))};return e.jsxs("div",{className:`mediapipe-pose-estimator ${m} p-2`,children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{className:"px-3 py-1 rounded-lg border text-sm",onClick:t,"aria-pressed":c,children:c?"Stop Camera":"Start Camera"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:r?"Model ready":"Loading model..."})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"relative bg-black/5 rounded overflow-hidden",children:[e.jsx("video",{ref:p,className:"w-full h-auto max-h-96",autoPlay:!0,playsInline:!0,muted:!0,style:{display:c?"block":"none"}}),x&&e.jsx("canvas",{ref:j,id:"pose-output",className:"absolute inset-0 w-full h-full pointer-events-none"}),!c&&e.jsx("div",{className:"p-6 text-center text-sm text-slate-500",children:"Camera is off â€” press Start Camera"})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-sm",children:"Controls / Info"}),e.jsxs("ul",{className:"text-xs mt-2",children:[e.jsxs("li",{children:["Model: ",l?new URL(l).pathname.split("/").pop():"default"]}),e.jsxs("li",{children:["Mode: ",g]}),e.jsxs("li",{children:["Poses: ",o]})]})]})]})]})}I.__docgenInfo={description:"",methods:[],displayName:"PoseEstimator",props:{modelUrl:{required:!1,tsType:{name:"string"},description:""},delegate:{required:!1,tsType:{name:"union",raw:'"GPU" | "CPU" | "AUTO"',elements:[{name:"literal",value:'"GPU"'},{name:"literal",value:'"CPU"'},{name:"literal",value:'"AUTO"'}]},description:""},numPoses:{required:!1,tsType:{name:"number"},description:""},runningMode:{required:!1,tsType:{name:"union",raw:'"IMAGE" | "VIDEO"',elements:[{name:"literal",value:'"IMAGE"'},{name:"literal",value:'"VIDEO"'}]},description:""},showCanvas:{required:!1,tsType:{name:"boolean"},description:""},drawSkeleton:{required:!1,tsType:{name:"boolean"},description:""},onResults:{required:!1,tsType:{name:"signature",type:"function",raw:"(results: any) => void",signature:{arguments:[{type:{name:"any"},name:"results"}],return:{name:"void"}}},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};export{_ as M,I as P};
